<html metal:use-macro="load: base_auth.pt" tal:define="date import: datetime.date">

<ul metal:fill-slot="navitems" class="nav navbar-nav">
	<li><a href="${request.route_url('shows')}">Shows</a></li>
	<li class="active"><a href="${request.route_url('episodes')}">Episodes</a></li>
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Feeds <span class="caret"></span></a>
		<ul class="dropdown-menu">
			<li><a href="${request.route_url('settings_feed')}">Feed settings</a></li>
			<li><a href="${request.route_url('settings_token')}">Access token</a></li>
		</ul>
	</li>
</ul>

<div metal:fill-slot="main" class="container">
	<div class="page-header">
		<h1>Your Episodes</h1>
	</div>

	<p>Your list of episodes is also available as a <a href="${request.route_url('feed', user=user.name, token=user.token)}">web feed</a> and as an <a href="${request.route_url('ical', user=user.name, token=user.token)}">iCalendar</a>.</p>

	<h3>Recent</h3>
	<ul class="list-group" tal:define="global prevdate 0">
		<div tal:repeat="episode episodes" tal:omit-tag="">
			<div tal:condition="episode.airdate <= date.today()" tal:omit-tag="">
				<li class="list-group-item disabled" tal:condition="prevdate != episode.airdate">${episode.airdate.strftime('%B %d')}</li>
				<li class="list-group-item">${episode}</li>
				<span tal:define="global prevdate episode.airdate" tal:omit-tag="" />
			</div>
		</div>
	</ul>

	<h3>Upcoming</h3>
	<ul class="list-group" tal:define="global prevdate 0">
		<div tal:repeat="episode episodes" tal:omit-tag="">
			<div tal:condition="episode.airdate > date.today()" tal:omit-tag="">
				<li class="list-group-item disabled" tal:condition="prevdate != episode.airdate">${episode.airdate.strftime('%B %d')}</li>
				<li class="list-group-item">${episode}</li>
				<span tal:define="global prevdate episode.airdate" tal:omit-tag="" />
			</div>
		</div>
	</ul>

</div>

</html>
