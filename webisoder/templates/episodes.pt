<html metal:use-macro="load: base_auth.pt" tal:define="date import: datetime.date">

<ul metal:fill-slot="navitems" class="nav navbar-nav">
	<li><a href="${request.route_url('shows')}">Shows</a></li>
	<li class="active"><a href="${request.route_url('episodes')}">Episodes</a></li>
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Feeds <span class="caret"></span></a>
		<ul class="dropdown-menu">
			<li><a href="${request.route_url('settings_feed')}">Feed settings</a></li>
			<li><a href="${request.route_url('settings_token')}">Access token</a></li>
		</ul>
	</li>
</ul>

<div metal:fill-slot="main" class="container" id="episodes">
	<div class="page-header">
		<h1>Your Episodes</h1>
	</div>

	<p>Your list of episodes is also available as a <a href="${request.route_url('feed', user=user.name, token=user.token)}">web feed</a> and as an <a href="${request.route_url('ical', user=user.name, token=user.token)}">iCalendar</a>.</p>

	<div id="all" tal:define="global prevdate 0">
		<div tal:repeat="episode episodes" tal:omit-tag="">
			<h3 class="text-muted" tal:condition="prevdate != episode.airdate"><time>${episode.airdate.strftime('%A, %B %d, %Y')} <span tal:condition="episode.airdate == date.today()" class="label label-success">Today</span></time></h3>
			<div class="media">
				<div class="media-left">
					<img class="media-object" src="${request.route_url('banners', show_id=episode.show.url)}" alt="${episode.show.name}" />
				</div>
				<div class="media-body">
					<h4 class="media-heading">${episode.show.name}</h4>
					<a href="${episode.render(user.link_format)}">Season ${episode.season}, episode ${episode.num} &ndash; ${episode.title}<span class="text-muted" tal:condition="not:episode.title">Title unknown</span></a>
				</div>
			</div>
			<span tal:define="global prevdate episode.airdate" tal:omit-tag="" />
		</div>
	</div>
</div>

</html>
