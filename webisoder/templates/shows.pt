<html metal:use-macro="load: base_auth.pt">

<ul metal:fill-slot="navitems" class="nav navbar-nav">
	<li class="active"><a href="${request.route_url('shows')}">Shows</a></li>
	<li><a href="${request.route_url('episodes')}">Episodes</a></li>
	<li><a href="${request.route_url('settings_feed')}">Feeds</a></li>
</ul>

<div metal:fill-slot="main" class="container">
	<div class="page-header">
		<h1>Manage Your Shows</h1>
	</div>

	<div tal:condition="not:subscribed">
		<p>You are not currently subscribed to any shows. Use the search form to get started.</p>
	</div>
	<div tal:condition="subscribed">
		<p>This is a list of the shows that you are currently subscribed to. Episodes of these shows will be featured in your web feed and iCalendar.</p>
		<p>Use the search form to subscribe to additional shows.</p>
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Show name</th>
					<th>Status</th>
					<th>Next episode</th>
					<th>Options</th>
				</tr>
			</thead>
			<tr tal:repeat="show sorted(subscribed)">
				<td>
					<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
					${show.name}
				</td>
				<td>
					<span tal:condition="show.status">${show.status}</span>
					<span tal:condition="not:show.status" class="label label-warning">Unknown</span>
				</td>
				<td tal:define="next show.next_episode">
					<span tal:condition="next">${next.airdate.strftime('%B %d')}</span>
					<span tal:condition="not:next" class="text-warning">Unknown</span>
				</td>
				<td>
					<form method="post" action="${request.route_url('unsubscribe')}">
						<input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}" />
						<input type="hidden" name="show" value="${show.id}" />
						<input type="submit" class="btn btn-primary btn-xs" value="Unsubscribe" />
					</form>
				</td>
			</tr>
		</table>
	</div>

	<!-- the following table is for testing purposes only -->
	<table class="table">
		<thead>
			<tr>
				<th>Show name</th>
				<th>Options</th>
			</tr>
		</thead>
		<tr tal:repeat="item sorted(list(set(shows) - set(subscribed)))">
			<td>${item.name}</td>
			<td>
				<form method="post" action="${request.route_url('subscribe')}">
					<input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}" />
					<input type="hidden" name="show" value="${item.id}" />
					<input type="submit" class="btn btn-primary" value="Subscribe" />
				</form>
			</td>
		</tr>
	</table>
</div>

</html>
