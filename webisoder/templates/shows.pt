<html metal:use-macro="load: base_auth.pt">

<ul metal:fill-slot="navitems" class="nav navbar-nav">
	<li class="active"><a href="${request.route_url('shows')}">Shows</a></li>
	<li><a href="${request.route_url('episodes')}">Episodes</a></li>
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Feeds <span class="caret"></span></a>
		<ul class="dropdown-menu">
			<li><a href="${request.route_url('settings_feed')}">Feed settings</a></li>
			<li><a href="${request.route_url('settings_token')}">Access token</a></li>
		</ul>
	</li>
</ul>

<div metal:fill-slot="main" class="container">
	<div class="page-header">
		<h1>Manage Your Shows</h1>
	</div>

	<div tal:condition="not:subscribed">
		<p>You are not currently subscribed to any shows. Use the search form to get started.</p>
	</div>
	<div tal:condition="subscribed">
		<p>This is a list of the shows that you are currently subscribed to. Episodes of these shows will be featured in your web feed and iCalendar.</p>
		<p>Use the search form to subscribe to additional shows.</p>
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Show name</th>
					<th>Status</th>
					<th>Next episode</th>
					<th>Options</th>
				</tr>
			</thead>
			<tr tal:repeat="show sorted(subscribed)">
				<td>
					<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
					<a href="https://thetvdb.com/?tab=series&id=${show.url}">${show.name}</a>
				</td>
				<td>
					<span tal:condition="show.status == 1" class="label label-success">Running</span>
					<span tal:condition="show.status == 2" class="label label-info">Paused</span>
					<span tal:condition="show.status == 3" class="label label-default">Ended</span>
					<span tal:condition="show.status not in [1,2,3]" class="label label-warning">Unknown</span>
				</td>
				<td tal:define="next show.next_episode">
					<span tal:condition="next">${next.airdate.strftime('%B %d')}</span>
					<span tal:condition="not:next" class="text-warning">Unknown</span>
				</td>
				<td>
					<form method="post" action="${request.route_url('unsubscribe')}">
						<input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}" />
						<input type="hidden" name="show" value="${show.id}" />
						<input type="submit" class="btn btn-primary btn-xs" value="Unsubscribe" />
					</form>
				</td>
			</tr>
		</table>
	</div>
</div>

</html>
