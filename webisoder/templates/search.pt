<html metal:use-macro="load: base_auth.pt">

<ul metal:fill-slot="navitems" class="nav navbar-nav">
	<li class="active"><a href="${request.route_url('shows')}">Shows</a></li>
	<li><a href="${request.route_url('episodes')}">Episodes</a></li>
</ul>

<div metal:fill-slot="main" class="container">
	<div class="page-header">
		<h1>Search results</h1>
	</div>

	<div class="panel panel-default">
		<div class="panel-heading">
			<form class="form-inline" method="post" action="${request.route_url('search')}">
				<div tal:condition="'search' in form_errors" class="alert alert-danger" role="alert">
					<strong>Error!</strong> ${form_errors.get('search')}
				</div>
				<div class="form-group">
					<label class="sr-only" for="searchShow">Show name</label>
					<div class="input-group">
						<input type="text" name="search" class="form-control" id="searchShow" placeholder="Search TV shows" required autofocus value="${search}" />
						<span class="input-group-btn">
							<button type="submit" class="btn btn-default">Search</button>
						</span>
					</div>
				</div>

			</form>
		</div>
		<div class="panel-body" tal:condition="not:shows">Nothing found, sorry.</div>
		<table class="table table-striped" tal:condition="shows">
			<thead>
				<tr>
					<th>Show name</th>
					<th>First aired</th>
					<th>Description</th>
					<th>Options</th>
				</tr>
			</thead>
			<tr tal:repeat="show sorted(shows)">
				<td>
					<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
					<a href="http://thetvdb.com/?tab=series&id=${show.seriesid}">${show.seriesname}</a>
				</td>
				<td>
					<span tal:condition="show.get('firstaired')">${show.firstaired}</span>
					<span tal:condition="not:show.get('firstaired')" class="text-muted">Unknown</span>
				</td>
				<td>
					<span tal:condition="show.get('overview')">${show.overview}</span>
					<span tal:condition="not:show.get('overview')" class="text-muted">No description available</span>
				</td>
				<td>
					<form method="post" action="/subscribe-ext"> <!-- TODO use dynamic URL -->
						<input type="hidden" name="csrf_token" value="${request.session.get_csrf_token()}" />
						<input type="hidden" name="show" value="${show.seriesid}" />
						<input type="submit" class="btn btn-primary btn-xs" value="Subscribe" />
					</form>
				</td>
			</tr>
		</table>
	</div>
</div>
</html>
